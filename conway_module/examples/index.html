<!doctype html>
<html lang="en">
	<head>
		<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
		<meta charset="utf-8">
		<title>Conway's Game of Life</title>
		<style>
			#canvas_container{
				background-color: #FFFFFF;
				border: 1px solid black;
				z-index: 0;
	    	position: relative;
			}

			canvas{
			}

			#grid_canvas {
				z-index: 1;
				position: absolute;
				margin-top:0px;
				margin-left:0px;
			}

			#sim_canvas {
				z-index: 2;
				position: absolute;
				margin-top:0px;
				margin-left:0px;
			}

			.container{
				display: flex;
				background-color:#e1e2e1;
			}

			.col{
				flex-direction: column;
			}

			.row{
				flex-direction: row;
				padding-top: 10px;
			}

			body{
				background-color: #000000;
				font-family: 'Roboto', sans-serif;
				margin: 8px;
			}

			#simulation_controls{
				padding-left: 10px;
				margin-bottom: 10px;
			}

			#block{
				height: 24px;
				background-color: #006db3
			}
			#header{
				background-color: #039be5;
				border-top-width: 1px;
				border-top-color: #3fafe8;
				border-top-style: solid;
			}

			#cell_size{
				width: 3em;
			}

			h1{
				color: #000000;
				margin-left: 20px;
			}
		</style>
	</head>
	<script src="./../dist/conways-game.js"></script>
	<body>
		<div class="container col">
			<div id='block'></div>
			<div id='header'>
				<h1>Conway's Game Of Life</h1>
			</div>
			<div id="control_bar">
				<div class="container row">
					<!--
					Seed Preset Combo
					Cell Size
					Shape Combo
					Start/Pause Button
					Clear Button -->
					<label for="topology">Topology</label>
					<select id="topology">
						<option value="plane_with_dead_border">Finite Grid</option>
					</select>

					<label for="seed">Preset</label>
					<select id="seed">
						<option value="draw">Draw</option>
						<option value="random">Random</option>
					</select>

					<label for="cell_shape">Cell Shape</label>
					<select id="cell_shape">
						<option value="circle">Circle</option>
					</select>

					<label for="cell_size">Cell Size</label>
					<input id="cell_size" type="number" min="1" max="100" value="20" step="1" onchange="changed_cell_size();"/>

					<button id="play_pause_button" type="button" onclick="toggle_simulation();">Start</button>
					<button id="reset_button" type="button" onclick="reset_simulation();">Reset</button>
				</div>
				<div class="container row">
					<input type="checkbox" id="display_storage" name="display_storage" onclick="toggle_display_storage_structure();"/>
					<label for="display_storage">Display Storage Structure</label>

					<input type="checkbox" id="display_grid_background" name="display_grid_background" onclick="toggle_display_grid_background();"/>
					<label for="display_grid_background">Display Grid</label>
				</div>
			</div>
			<div id="canvas_container">
				<canvas id="grid_canvas"></canvas>
				<canvas id="sim_canvas"></canvas>
			</div>
			<div id="status_bar">
				<span><label># Alive Cells: XX</label> <label>Generation: XX</label></span>
			</div>
		</div>

		<!--
			Next Steps:
				- Split into multiple canvases and systems. (Grid, Sim, Draw)

				Drawing
				- Add Mouse Listeners
					- Only when the simulation is stopped.
				- Convert Mouse click to Cell Space
				- Draw cells that have been created by clicking.
		 -->
		<script type="application/javascript">
			//TODO: Rethink this code to load the JS on Load and Resize events. The canvas should resize appropriately.
			window.addEventListener('load', function(event){
				sizeCanvas(config)
				life.main(window.performance.now());
			})

			window.addEventListener('resize', function(event){
				sizeCanvas(config)
			})

			let LifeSystem = Conways.LifeSystem
			let config = Conways.DefaultConfig

			let gridCanvas = document.getElementById('grid_canvas')
			let simCanvas = document.getElementById('sim_canvas')

			let life = new LifeSystem(window, simCanvas.getContext('2d'), config)

			/* Hold that thought. Get Grid System working first.
			canvas.addEventListener('click', (clickEvent) => {
				//Get Pixel clicked.
				let boundary = canvas.getBoundingClientRect()
				let px = clickEvent.clientX - boundary.left
				let py = clickEvent.clientY - boundary.top

				//Project to a Cell
				let cx = Math.round(px/config.zoom)
				let cy = Math.round(py/config.zoom)
				life.addCell(cx,cy)
			})
			*/

			function sizeCanvas(config){
				//Override the default configuration to size the HTML Canvas
				//to fit the document. Note: This will use the same padding/margins
				//as the HTML Body.
				let blockElement = document.getElementById('block')
				let headerElement = document.getElementById('header')
				let controlBarElement = document.getElementById('control_bar')
				let statusBarElement = document.getElementById('status_bar')
				let bodyMargin = 8 * 2; //Padding on body element in CSS is 8 top and bottom.

				config.canvas.height = window.innerHeight - bodyMargin - (blockElement.offsetHeight + headerElement.offsetHeight + controlBarElement.offsetHeight + statusBarElement.offsetHeight)

				let canvasContainerDiv = document.getElementById('canvas_container')
				let gridCanvas = document.getElementById('grid_canvas')
				let simCanvas = document.getElementById('sim_canvas')

				//WARNING: Setting the canvas height changes the body
				//width so always set the height before the width.
				canvasContainerDiv.style.height = `${config.canvas.height}px`
				gridCanvas.setAttribute('height', config.canvas.height)
				simCanvas.setAttribute('height', config.canvas.height)

				config.canvas.width = document.body.clientWidth
				canvasContainerDiv.style.width = `${config.canvas.width}px`
				gridCanvas.setAttribute('width', config.canvas.width)
				simCanvas.setAttribute('width', config.canvas.width)
			}



			function toggle_simulation(){
				let button = document.getElementById('play_pause_button')

				switch (button.innerText){
					case 'Start':
						button.innerText = 'Pause'
						start_simulation()
						break;
					case 'Pause':
						button.innerText = 'Resume'
						stop_simulation()
						break;
					case 'Resume':
						button.innerText = 'Pause'
						resume_simulation()
						break;
					default:
						break;
				}
			}

			function reset_simulation(){
				stop_simulation()
				let button = document.getElementById('play_pause_button')
				button.innerText = "Start"
				life.reset()
			}

			function start_simulation(){
				config.zoom = getCellSize()
				config.landscape.width = config.canvas.width/config.zoom
				config.landscape.height = config.canvas.height/config.zoom
				life.start()
			}

			function getCellSize(){
				let cellSizeControl = document.getElementById('cell_size')
				return Number.parseInt(cellSizeControl.value)
			}

			function stop_simulation(){
				life.stop()
			}

			function resume_simulation(){
				life.resume()
			}

			function toggle_display_storage_structure(){
				let displayStorageCheckbox = document.getElementById('display_storage')
				life.displayStorage(displayStorageCheckbox.checked)
			}

			function toggle_display_grid_background(){
				let displayGridBackground = document.getElementById('display_grid_background')
				life.displayGrid(displayGridBackground.checked)
			}

			function changed_cell_size(){
				life.setCellSize(getCellSize())
			}
		</script>
	</body>
</html>
